---
import { APP_URL } from '../config';

interface Props {
  /**
   * Whether the header starts transparent (for pages with a hero image).
   * Defaults to true (homepage behaviour).
   */
  transparent?: boolean;
}

const { transparent = true } = Astro.props;
---

<header
  id="site-header"
  class:list={[
    'fixed top-0 left-0 right-0 z-50 transition-all duration-300',
    !transparent && 'header-scrolled',
  ]}
  data-transparent={transparent ? 'true' : 'false'}
>
  <div class="container flex h-16 items-center justify-between">
    <a href="/" class="flex items-center gap-2">
      <span class="font-serif text-xl font-semibold header-text-color transition-colors duration-300">
        Epic Itineraries
      </span>
      <span class="text-brand-coral text-xl font-bold">.</span>
    </a>

    <!-- Desktop navigation -->
    <nav class="hidden md:flex items-center gap-6 text-sm">
      <a
        href="/how-it-works"
        class="font-medium header-text-color transition-colors duration-300 hover:opacity-80"
      >
        How It Works
      </a>
      <a
        href="/get"
        class="font-medium header-text-color transition-colors duration-300 hover:opacity-80"
      >
        Get
      </a>
      <a
        href="/blog"
        class="font-medium header-text-color transition-colors duration-300 hover:opacity-80"
      >
        Blog
      </a>
      <a
        href="/about"
        class="font-medium header-text-color transition-colors duration-300 hover:opacity-80"
      >
        About
      </a>
    </nav>

    <div class="flex items-center gap-4">
      <a
        href={APP_URL}
        class="hidden md:inline text-sm font-medium header-text-color transition-colors duration-300 hover:opacity-80"
      >
        Log in
      </a>
      <a
        href={APP_URL}
        class="hidden md:inline-flex h-10 items-center justify-center rounded-full bg-primary px-6 text-sm font-medium text-primary-foreground transition-colors hover:bg-brand-green-light"
      >
        Get Started
      </a>

      <!-- Mobile hamburger button -->
      <label
        for="mobile-menu-toggle"
        class="md:hidden flex h-10 w-10 items-center justify-center rounded-lg cursor-pointer header-text-color transition-colors duration-300 hover:opacity-80"
        aria-label="Open menu"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hamburger-icon" aria-hidden="true">
          <line x1="4" x2="20" y1="6" y2="6"></line>
          <line x1="4" x2="20" y1="12" y2="12"></line>
          <line x1="4" x2="20" y1="18" y2="18"></line>
        </svg>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="close-icon" aria-hidden="true">
          <path d="M18 6 6 18"></path>
          <path d="m6 6 12 12"></path>
        </svg>
      </label>
    </div>
  </div>
</header>

<!-- Mobile menu (checkbox hack for zero-JS) -->
<input type="checkbox" id="mobile-menu-toggle" class="mobile-menu-checkbox sr-only" aria-hidden="true" />
<div class="mobile-menu-overlay md:hidden" aria-label="Mobile navigation">
  <nav class="flex flex-col gap-2 p-6 pt-20">
    <a href="/how-it-works" class="text-lg font-medium text-primary py-3 border-b border-border transition-colors hover:text-brand-coral">
      How It Works
    </a>
    <a href="/get" class="text-lg font-medium text-primary py-3 border-b border-border transition-colors hover:text-brand-coral">
      Get
    </a>
    <a href="/blog" class="text-lg font-medium text-primary py-3 border-b border-border transition-colors hover:text-brand-coral">
      Blog
    </a>
    <a href="/about" class="text-lg font-medium text-primary py-3 border-b border-border transition-colors hover:text-brand-coral">
      About
    </a>
    <div class="flex flex-col gap-3 mt-6">
      <a
        href={APP_URL}
        class="inline-flex h-12 items-center justify-center rounded-full border border-border px-6 text-base font-medium text-primary transition-colors hover:bg-brand-cream-dark"
      >
        Log in
      </a>
      <a
        href={APP_URL}
        class="inline-flex h-12 items-center justify-center rounded-full bg-primary px-6 text-base font-medium text-primary-foreground transition-colors hover:bg-brand-green-light"
      >
        Get Started
      </a>
    </div>
  </nav>
</div>

<script>
  const header = document.getElementById('site-header');
  if (header) {
    const isTransparent = header.dataset.transparent === 'true';

    if (isTransparent) {
      const handleScroll = () => {
        if (window.scrollY > 80) {
          header.classList.add('header-scrolled');
          header.classList.remove('header-transparent');
        } else {
          header.classList.remove('header-scrolled');
          header.classList.add('header-transparent');
        }
      };
      header.classList.add('header-transparent');
      handleScroll();
      window.addEventListener('scroll', handleScroll, { passive: true });
    }
    // Non-transparent headers already have header-scrolled class set server-side
  }
</script>
